server {
    listen 80 default_server;
    listen [::]:80 default_server;
    server_name _;

    root /var/www/html;
    index index.php index.html;

    # ===================================
    # SECURITY: Deny access to sensitive directories and files
    # ===================================
    location ~ ^/(data|lib|init)/ {
        deny all;
        return 403;
    }

    location ~ \.(db|sqlite|sqlite3)$ {
        deny all;
        return 403;
    }

    # ===================================
    # PHP PROCESSING
    # ===================================
    location ~ \.php$ {
        include snippets/fastcgi-php.conf;
        fastcgi_pass unix:/run/php/php8.2-fpm.sock;
    }

    # ===================================
    # URL REFERENCING: /page -> /page.php
    # ===================================
    location / {
        # Special handling for /debug -> /admin/debug.php
        if ($uri = /debug) {
            rewrite ^ /admin/debug.php last;
        }
        
        try_files $uri $uri/ @rewrite;
        }   

        location @rewrite {
            rewrite ^/(.*)$ /$1.php last;
        }
    }